#cloud-config
hostname: homeautomation
manage_etc_hosts: true
packages:
- avahi-daemon
- net-tools
- iproute2
- raspi-config
- build-essential
- git
- curl
- wget
- unzip
apt:
  conf: |
    Acquire {
      Check-Date "false";
    };

package_update: true
package_upgrade: true

# Setup rpi as system user, default password is "changeme"
users:
- name: rpi
  groups: users,adm,dialout,audio,netdev,video,plugdev,cdrom,games,input,gpio,spi,i2c,render,sudo
  shell: /bin/bash
  lock_passwd: false
  passwd: $5$WROBDhsulN$lZgNU4Ab2ISyCUGQiYfoqZjH3ZnawDj2cXT1l7qYP.5

# Enable password authentication for SSH
ssh_pwauth: true


write_files:
- encoding: b64
  content: IyEvYmluL2Jhc2gKc2V0IC1ldW8gcGlwZWZhaWwKCmV4cG9ydCBERUJJQU5fRlJPTlRFTkQ9bm9uaW50ZXJhY3RpdmUKCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KIyBEb2NrZXIgaW5zdGFsbGF0aW9uCiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KCmVjaG8gIj09PSBVcGRhdGUgYXB0IGNhY2hlIGFuZCBpbnN0YWxsIHByZXJlcXVpc2l0ZXMgPT09IgphcHQtZ2V0IHVwZGF0ZQphcHQtZ2V0IGluc3RhbGwgLXkgY2EtY2VydGlmaWNhdGVzIGN1cmwKaW5zdGFsbCAtbSAwNzU1IC1kIC9ldGMvYXB0L2tleXJpbmdzCmN1cmwgLWZzU0wgaHR0cHM6Ly9kb3dubG9hZC5kb2NrZXIuY29tL2xpbnV4L3VidW50dS9ncGcgLW8gL2V0Yy9hcHQva2V5cmluZ3MvZG9ja2VyLmFzYwpjaG1vZCBhK3IgL2V0Yy9hcHQva2V5cmluZ3MvZG9ja2VyLmFzYwoKZWNobyAiPT09IEFkZCBkb2NrZXIgcmVwb3NpdG9yeSB0byBhcHQgc291cmNlcyA9PT0iCnRlZSAvZXRjL2FwdC9zb3VyY2VzLmxpc3QuZC9kb2NrZXIuc291cmNlcyA8PEVPRgpUeXBlczogZGViClVSSXM6IGh0dHBzOi8vZG93bmxvYWQuZG9ja2VyLmNvbS9saW51eC91YnVudHUKU3VpdGVzOiAkKC4gL2V0Yy9vcy1yZWxlYXNlICYmIGVjaG8gIiR7VUJVTlRVX0NPREVOQU1FOi0kVkVSU0lPTl9DT0RFTkFNRX0iKQpDb21wb25lbnRzOiBzdGFibGUKU2lnbmVkLUJ5OiAvZXRjL2FwdC9rZXlyaW5ncy9kb2NrZXIuYXNjCkVPRgoKZWNobyAiPT09IFVwYWRlIHN5c3RlbSB3aXRoIHRoZSBwYWNrYWdlIGxpc3QgZnJvbSBkb2NrZXIgcmVwb3NpdG9yeSA9PT0iCmFwdC1nZXQgdXBkYXRlCgplY2hvICI9PT0gSW5zdGFsbCBkb2NrZXIgcGFja2FnZXMgPT09IgphcHQtZ2V0IGluc3RhbGwgLXkgZG9ja2VyLWNlIGRvY2tlci1jZS1jbGkgY29udGFpbmVyZC5pbyBkb2NrZXItYnVpbGR4LXBsdWdpbiBkb2NrZXItY29tcG9zZS1wbHVnaW4KCmVjaG8gIj09PSBBZGQgcnBpIHVzZXIgdG8gdGhlIGRvY2tlciBncm91cCB0byBncmFudCBhbGwgdGhlIHBlcm1pc3Npb25zIHJlbGF0ZWQgdG8gZG9ja2VyID09PSIKdXNlcm1vZCAtYUcgZG9ja2VyIHJwaQoKc3lzdGVtY3RsIGVuYWJsZSBkb2NrZXIKc3lzdGVtY3RsIHN0YXJ0IGRvY2tlcgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIENvbmZpZ3VyZSBQQ0kgRXhwcmVzcyAzLCAxLVdpcmUgYW5kIENBTiBpbiBjb25maWcudHh0CiMgPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0KZWNobyAiPT09IENvbmZpZ3VyaW5nIFBDSSBFeHByZXNzIDMsIDEtV2lyZSBhbmQgQ0FOIGluIGNvbmZpZy50eHQgPT09IgpzdWRvIHRlZSAtYSAiL2Jvb3QvZmlybXdhcmUvY29uZmlnLnR4dCIgPiAvZGV2L251bGwgPDwgJ0VPRicKIyBFbmFibGUgUENJIEV4cHJlc3MgMwpkdHBhcmFtPXBjaWV4MQpkdHBhcmFtPXBjaWV4MV9nZW49MwoKIyBFbmFibGUgMS1XaXJlIGNvbW11bmljYXRpb24KZHRvdmVybGF5PXcxLWdwaW8KCiMgRW5hYmxlIENBTiBjb21tdW5pY2F0aW9uCmR0b3ZlcmxheT1pMmMwCmR0b3ZlcmxheT1zcGkxLTNjcwpkdG92ZXJsYXk9bWNwMjUxNSxzcGkxLTIsb3NjaWxsYXRvcj0xNjAwMDAwMCxpbnRlcnJ1cHQ9MTMKZHRvdmVybGF5PW1jcDI1MTUsc3BpMS0xLG9zY2lsbGF0b3I9MTYwMDAwMDAsaW50ZXJydXB0PTIyCkVPRgoKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQojIFJhc3BiZXJyeSBQaSAyLUNIIENBTiBIQVQgc2V0dXAKIyA9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PQoKZWNobyAiPT09IEluc3RhbGxpbmcgY2FuLXV0aWxzID09PSIKYXB0LWdldCBpbnN0YWxsIGNhbi11dGlscwoKZWNobyAiPT09IENyZWF0aW5nIHN5c3RlbWQgc2VydmljZSBmb3IgY2FuMCA9PT0iCmNhdCA8PCAnRU9GJyA+IC9ldGMvc3lzdGVtZC9zeXN0ZW0vY2FuMC5zZXJ2aWNlCltVbml0XQpEZXNjcmlwdGlvbj1TZXQgdXAgY2FuMCBpbnRlcmZhY2UKUmVxdWlyZXM9bmV0d29yay50YXJnZXQKQWZ0ZXI9bmV0d29yay50YXJnZXQKCltTZXJ2aWNlXQpUeXBlPW9uZXNob3QKRXhlY1N0YXJ0PS9zYmluL2lwIGxpbmsgc2V0IGNhbjAgdXAgdHlwZSBjYW4gYml0cmF0ZSA1MDAwMDAKRXhlY1N0YXJ0UG9zdD0vc2Jpbi9pcCBsaW5rIHNldCBjYW4wIHR4cXVldWVsZW4gNjU1MzYKRXhlY1N0b3A9L3NiaW4vaXAgbGluayBzZXQgY2FuMCBkb3duClJlbWFpbkFmdGVyRXhpdD15ZXMKCltJbnN0YWxsXQpXYW50ZWRCeT1tdWx0aS11c2VyLnRhcmdldApFT0YKCmVjaG8gIj09PSBDcmVhdGluZyBzeXN0ZW1kIHNlcnZpY2UgZm9yIGNhbjEgPT09IgpjYXQgPDwgJ0VPRicgPiAvZXRjL3N5c3RlbWQvc3lzdGVtL2NhbjEuc2VydmljZQpbVW5pdF0KRGVzY3JpcHRpb249U2V0IHVwIGNhbjEgaW50ZXJmYWNlClJlcXVpcmVzPW5ldHdvcmsudGFyZ2V0CkFmdGVyPW5ldHdvcmsudGFyZ2V0CgpbU2VydmljZV0KVHlwZT1vbmVzaG90CkV4ZWNTdGFydD0vc2Jpbi9pcCBsaW5rIHNldCBjYW4xIHVwIHR5cGUgY2FuIGJpdHJhdGUgNTAwMDAwCkV4ZWNTdGFydFBvc3Q9L3NiaW4vaXAgbGluayBzZXQgY2FuMSB0eHF1ZXVlbGVuIDY1NTM2CkV4ZWNTdG9wPS9zYmluL2lwIGxpbmsgc2V0IGNhbjEgZG93bgpSZW1haW5BZnRlckV4aXQ9eWVzCgpbSW5zdGFsbF0KV2FudGVkQnk9bXVsdGktdXNlci50YXJnZXQKRU9GCgplY2hvICI9PT0gRW5hYmxpbmcgQ0FOIHNlcnZpY2VzID09PSIKc3lzdGVtY3RsIGRhZW1vbi1yZWxvYWQKc3lzdGVtY3RsIGVuYWJsZSBjYW4wLnNlcnZpY2UKc3lzdGVtY3RsIGVuYWJsZSBjYW4xLnNlcnZpY2UKc3lzdGVtY3RsIHN0YXJ0IGNhbjAuc2VydmljZSB8fCBlY2hvICJjYW4wIGlzIG5vdCBhdmFpbGFibGUgeWV0IgpzeXN0ZW1jdGwgc3RhcnQgY2FuMS5zZXJ2aWNlIHx8IGVjaG8gImNhbjEgaXMgbm90IGF2YWlsYWJsZSB5ZXQiCgojPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IgojIEluc3RhbGwgaG9tZSBhdXRvbWF0aW9uIGFnZW50CiM9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0iCgplY2hvICI9PT0gSW5zdGFsbCBIb21lIEF1dG9tYXRpb24gQWdlbnQgPT09IgoKY3VybCAtZkwgLU8gaHR0cHM6Ly9naXRodWIuY29tL25lamNva29ybi9ob21lLWF1dG9tYXRpb24tYWdlbnQvcmVsZWFzZXMvZG93bmxvYWQvdjEuMi4wL2hvbWUtYXV0b21hdGlvbi1hZ2VudF8xLjIuMF9hcm02NC5kZWIKCiMgSW5zdGFsbCBob21lLWF1dG9tYXRpb24tYWdlbnRfMS4yLjBfYXJtNjQuZGViCnN1ZG8gZHBrZyAtaSBob21lLWF1dG9tYXRpb24tYWdlbnRfMS4yLjBfYXJtNjQuZGViCgojIEZpeCBicm9rZW4gZGVwZW5kZW5jaWVzIGlmIGFueQphcHQtZ2V0IC1mIGluc3RhbGwgLXkKCnN1ZG8gc3lzdGVtY3RsIGRhZW1vbi1yZWxvYWQKc3VkbyBzeXN0ZW1jdGwgZW5hYmxlIC0tbm93IGhvbWUtYXV0b21hdGlvbi1hZ2VudAoKIz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSIKIyBTZXR1cCBob21lIGF1dG9tYXRpb24gc3RhY2sKIz09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PSIKCmVjaG8gIj09PSBTZXR1cCBob21lIGF1dG9tYXRpb24gc3RhY2sgPT09IgoKbWtkaXIgLXAgL2hvbWUvcnBpCmNkIC9ob21lL3JwaQpnaXQgY2xvbmUgaHR0cHM6Ly9naXRodWIuY29tL25lamNva29ybi9ob21lLWF1dG9tYXRpb24uZ2l0CmNob3duIHJwaTpycGkgL2hvbWUvcnBpIC1SCmNkIC9ob21lL3JwaS9ob21lLWF1dG9tYXRpb24Kc3VkbyAtdSBycGkgYmFzaCAtYyAnY2QgL2hvbWUvcnBpL2hvbWUtYXV0b21hdGlvbiAmJiAuL3NjcmlwdHMvY29tcG9zZS1lbnYuc2gnCgplY2hvICI9PT0gSW5zdGFsbCBIQUNTIGluIEhvbWUgQXNzaXN0YW50ID09PSIKc3VkbyAtdSBycGkgYmFzaCA8PCdFT0YnCmRvY2tlciBleGVjIGhvbWVhc3Npc3RhbnQgYmFzaCAtYyAnCgljdXJsIC00IC1mc1NMIGh0dHBzOi8vZ2V0LmhhY3MueHl6IHwgYmFzaCAtCicKRU9GCgplY2hvICI9PT0gSW5zdGFsbCBOb2RlLVJFRCBwYWNrYWdlcyA9PT0iCnN1ZG8gLXUgcnBpIGJhc2ggPDwnRU9GJwpkb2NrZXIgZXhlYyBub2RlcmVkIGJhc2ggLWMgJwoJY2QgL2RhdGEKCW5wbSBpbnN0YWxsIEBob21lLWF1dG9tYXRpb24vaG9tZS1hdXRvbWF0aW9uLW1haW4KCW5wbSBpbnN0YWxsIG5vZGUtcmVkLWNvbnRyaWItc3VuLXBvc2l0aW9uCglucG0gaW5zdGFsbCBub2RlLXJlZC1jb250cmliLWhvbWUtYXNzaXN0YW50LXdlYnNvY2tldAonCkVPRgoKZWNobyAiPT09IFJlc3RhcnRpbmcgZG9ja2VyIHNlcnZpY2VzID09PSIKc3VkbyAtdSBycGkgYmFzaCA8PCdFT0YnCmNkIC9ob21lL3JwaS9ob21lLWF1dG9tYXRpb24KZG9ja2VyIGNvbXBvc2UgcmVzdGFydCBub2RlcmVkCmRvY2tlciBjb21wb3NlIHJlc3RhcnQgaG9tZWFzc2lzdGFudApFT0YKCiM9PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT0iCiMgUmVib290IHN5c3RlbSB0byBhcHBseSBhbGwgY2hhbmdlcwojPT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09PT09IgpyZWJvb3QK
  owner: root:root
  path: /usr/local/bin/homeautomation.sh
  permissions: '0755'

runcmd:
- [ bash, /usr/local/bin/homeautomation.sh ]